# -# 电影网站功能流程说明文档

## 目录
- [收藏功能流程](#收藏功能流程)
- [搜索功能流程](#搜索功能流程)
- [热门功能流程](#热门功能流程)
- [技术架构说明](#技术架构说明)

---

## 收藏功能流程

### 1. 功能概述
收藏功能允许用户将喜欢的电影添加到个人收藏列表中，方便后续查看和管理。

### 2. 核心组件
- **FavoriteButton.js**: 收藏按钮组件
- **MovieCard.js**: 电影卡片组件
- **favorites/page.js**: 收藏页面

### 3. 流程详解

#### 3.1 添加收藏流程
```
用户点击收藏按钮 → 检查登录状态 → 调用 addFavorite API → 更新 UI 状态
```

**详细步骤：**
1. 用户在电影卡片上点击收藏按钮
2. `FavoriteButton` 组件检查用户登录状态
3. 如果未登录，显示登录提示并跳转到登录页
4. 如果已登录，调用 `addFavorite(movieId)` API
5. API 请求成功后，更新按钮状态为已收藏
6. 显示成功提示信息

#### 3.2 取消收藏流程
```
用户点击已收藏按钮 → 调用 removeFavorite API → 更新 UI 状态
```

**详细步骤：**
1. 用户点击已收藏的按钮
2. 调用 `removeFavorite(movieId)` API
3. API 请求成功后，更新按钮状态为未收藏
4. 如果在收藏页面，从列表中移除该电影

#### 3.3 收藏状态检查
```
页面加载 → 获取电影列表 → 批量检查收藏状态 → 更新 UI 显示
```

### 4. API 接口

| 接口名称 | 功能 | 参数 | 返回值 |
|---------|------|------|--------|
| `addFavorite(movieId)` | 添加收藏 | 电影ID | 成功/失败状态 |
| `removeFavorite(movieId)` | 取消收藏 | 电影ID | 成功/失败状态 |
| `checkFavoriteStatus(movieId)` | 检查收藏状态 | 电影ID | 是否已收藏 |
| `getFavorites()` | 获取收藏列表 | 无 | 收藏电影列表 |

### 5. 权限控制
- 所有收藏相关操作都需要用户登录
- 通过 localStorage 中的 token 验证用户身份
- 未登录用户会被引导到登录页面

---

## 搜索功能流程

### 1. 功能概述
搜索功能提供电影搜索、搜索历史管理和热门搜索推荐等功能。

### 2. 核心组件
- **search/page.js**: 搜索页面主组件
- **SearchInput**: 搜索输入组件
- **SearchHistory**: 搜索历史组件
- **PopularSearches**: 热门搜索组件

### 3. 流程详解

#### 3.1 电影搜索流程
```
用户输入关键词 → 实时搜索建议 → 执行搜索 → 显示结果 → 保存搜索历史
```

**详细步骤：**
1. 用户在搜索框输入关键词
2. 实时显示搜索建议（防抖处理）
3. 用户按回车或点击搜索按钮
4. 调用 `searchMovies(keyword)` API
5. 显示搜索结果列表
6. 如果用户已登录，保存搜索历史

#### 3.2 搜索历史管理
```
加载历史记录 → 显示历史列表 → 点击历史项搜索 → 删除历史记录
```

**功能特点：**
- 仅对登录用户保存搜索历史
- 支持单个删除和清空所有历史
- 点击历史记录可快速重新搜索
- 按时间倒序显示

#### 3.3 热门搜索推荐
```
页面加载 → 获取热门搜索 → 显示推荐标签 → 点击标签搜索
```

### 4. API 接口

| 接口名称 | 功能 | 参数 | 返回值 |
|---------|------|------|--------|
| `searchMovies(keyword)` | 搜索电影 | 搜索关键词 | 电影搜索结果 |
| `saveSearchHistory(keyword)` | 保存搜索历史 | 搜索关键词 | 成功/失败状态 |
| `getSearchHistory()` | 获取搜索历史 | 无 | 搜索历史列表 |
| `deleteSearchHistory(id)` | 删除搜索历史 | 历史记录ID | 成功/失败状态 |
| `getPopularSearches()` | 获取热门搜索 | 无 | 热门搜索列表 |

### 5. 搜索优化
- **防抖处理**: 避免频繁API调用
- **缓存机制**: 缓存搜索结果提高性能
- **分页加载**: 大量结果分页显示
- **搜索建议**: 提供实时搜索建议

---

## 热门功能流程

### 1. 功能概述
热门功能展示当前最受欢迎的电影和搜索关键词，帮助用户发现热门内容。

### 2. 核心组件
- **popular/page.js**: 热门页面主组件
- **PopularMovies**: 热门电影组件
- **TrendingSection**: 趋势展示组件

### 3. 流程详解

#### 3.1 热门电影展示
```
页面加载 → 获取热门电影 → 按类别分组 → 展示电影列表
```

**展示类别：**
- 今日热门
- 本周热门
- 本月热门
- 年度热门

#### 3.2 热门搜索展示
```
获取热门搜索词 → 按热度排序 → 标签云展示 → 点击搜索
```

**特点：**
- 实时更新热门搜索词
- 按搜索频次排序
- 支持点击快速搜索
- 标签大小反映热度

### 4. API 接口

| 接口名称 | 功能 | 参数 | 返回值 |
|---------|------|------|--------|
| `getPopularMovies(period)` | 获取热门电影 | 时间周期 | 热门电影列表 |
| `getPopularSearches()` | 获取热门搜索 | 无 | 热门搜索词列表 |
| `getTrendingGenres()` | 获取热门类型 | 无 | 热门电影类型 |

### 5. 热门算法
- **观看次数**: 统计电影观看频次
- **收藏数量**: 统计电影收藏次数
- **评分权重**: 考虑电影评分因素
- **时间衰减**: 近期内容权重更高

---

## 技术架构说明

### 1. 前端技术栈
- **框架**: Next.js (React)
- **UI库**: Ant Design
- **状态管理**: React Context + useState/useEffect
- **路由**: Next.js App Router
- **HTTP客户端**: Fetch API

### 2. 后端接口
- **认证方式**: JWT Token
- **数据存储**: localStorage (前端缓存)
- **错误处理**: 统一错误处理机制
- **请求拦截**: 自动添加认证头

### 3. 数据流向
```
用户操作 → React组件 → API调用 → 后端处理 → 数据库操作 → 返回结果 → 更新UI
```

### 4. 安全考虑
- **身份验证**: 所有敏感操作需要登录
- **数据验证**: 前后端双重数据验证
- **错误处理**: 不暴露敏感错误信息
- **XSS防护**: 输入内容转义处理

### 5. 性能优化
- **懒加载**: 组件和图片懒加载
- **缓存策略**: 合理使用浏览器缓存
- **防抖节流**: 搜索输入防抖处理
- **分页加载**: 大数据量分页展示

---

## 总结

本文档详细介绍了电影网站的三大核心功能：收藏、搜索和热门功能的完整实现流程。每个功能都包含了从用户交互到后端处理的完整链路，并提供了相应的API接口说明和技术实现细节。

这些功能共同构成了一个完整的电影推荐和管理系统，为用户提供了便捷的电影发现、收藏和搜索体验。
